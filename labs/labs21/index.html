<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lab 21 ‚Äì Fingerprinting de firewalls y t√©cnicas evasivas</title>
  <link rel="icon" href="/el-pergamino-digital/assets/favicon.png" type="image/png" />
  <style>
    :root { color-scheme: dark; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 2em;
      line-height: 1.6;
    }
    h1, h2 {
      color: #90caf9;
    }
    code {
      background-color: #1e1e1e;
      padding: 0.2em 0.4em;
      border-radius: 4px;
      font-family: Consolas, monospace;
    }
    pre {
      background-color: #1e1e1e;
      padding: 1em;
      border-radius: 6px;
      overflow-x: auto;
    }
    a {
      color: #90caf9;
    }
  </style>
</head>
<body>

  <h1>Lab 21 ‚Äì Fingerprinting de firewalls y t√©cnicas evasivas</h1>
  <h2>Identificaci√≥n de firewalls mediante escaneos controlados y an√°lisis de respuestas filtradas</h2>

  <section>
    <h2>1. Objetivo</h2>
    <p>Este laboratorio permite identificar la presencia y el tipo de firewall en una red objetivo mediante t√©cnicas de escaneo espec√≠ficas. El fingerprinting de firewalls es clave para adaptar estrategias ofensivas, evaluar la superficie de ataque y preparar t√©cnicas de evasi√≥n en fases posteriores.</p>
  </section>

  <section>
    <h2>2. Nivel de dificultad</h2>
    <p>Intermedio</p>
  </section>

  <section>
    <h2>3. Herramientas utilizadas</h2>
    <ul>
      <li><code>nmap</code></li>
      <li><code>hping3</code></li>
      <li><code>firewalk</code></li>
      <li><code>Wireshark</code></li>
    </ul>
  </section>

  <section>
    <h2>4. Entorno de laboratorio</h2>
    <p>M√°quina atacante con Kali Linux, m√°quina v√≠ctima con firewall activo (iptables, pf o similar), red virtual controlada con capacidad de inspecci√≥n de tr√°fico.</p>
  </section>

  <section>
    <h2>5. Escenario</h2>
    <p>Un analista ofensivo necesita identificar si un firewall est√° presente entre su m√°quina y un objetivo. El objetivo es determinar el tipo de filtrado (stateless o stateful), los puertos filtrados y las posibles reglas activas, utilizando t√©cnicas de escaneo y an√°lisis de respuestas.</p>
  </section>

  <section>
    <h2>6. Pasos previos</h2>
    <ul>
      <li>Verificar conectividad entre atacante y v√≠ctima</li>
      <li>Activar reglas de firewall en la m√°quina v√≠ctima</li>
      <li>Iniciar Wireshark en la m√°quina atacante para capturar tr√°fico</li>
    </ul>
  </section>

  <section>
    <h2>7. Desarrollo</h2>
    <ol>
      <li>Escaneo ACK para detectar puertos filtrados:
        <pre><code>nmap -sA -p 22,80,443 192.168.1.30</code></pre>
      </li>
      <li>Escaneo con paquetes fragmentados:
        <pre><code>nmap -f -p 80,443 192.168.1.30</code></pre>
      </li>
      <li>Manipulaci√≥n de TTL con firewalk:
        <pre><code>firewalk -S -n -p 80,443 -i eth0 -T 1 192.168.1.1 192.168.1.30</code></pre>
      </li>
      <li>Env√≠o de paquetes TCP sin handshake:
        <pre><code>hping3 -S -p 80 -c 1 192.168.1.30</code></pre>
      </li>
      <li>Captura de respuestas ICMP Type 3 o silencios para inferir reglas</li>
    </ol>
  </section>

    <section>
    <h2>8. Resultados esperados</h2>
    <ul>
      <li>Identificaci√≥n de puertos filtrados por el firewall</li>
      <li>Detecci√≥n de reglas de filtrado basadas en estado o tipo de paquete</li>
      <li>Inferencia del tipo de firewall (stateless vs stateful)</li>
      <li>Capturas de tr√°fico que evidencien bloqueos, silencios o respuestas ICMP</li>
    </ul>
  </section>

  <section>
    <h2>9. An√°lisis de resultados</h2>
    <p>El an√°lisis de las respuestas (o su ausencia) permite inferir la presencia de un firewall y su comportamiento. Por ejemplo, si un escaneo ACK no devuelve respuestas, es probable que los puertos est√©n filtrados por un firewall stateful. La manipulaci√≥n de TTL y la fragmentaci√≥n ayudan a identificar si el filtrado es superficial o profundo.</p>
  </section>

  <section>
    <h2>10. Conclusiones</h2>
    <p>El fingerprinting de firewalls es una fase cr√≠tica en el reconocimiento ofensivo. Permite adaptar las t√©cnicas de escaneo y evasi√≥n seg√∫n el tipo de defensa detectada. Este laboratorio sienta las bases para t√©cnicas m√°s avanzadas de evasi√≥n y explotaci√≥n.</p>
  </section>

  <section>
    <h2>11. Medidas</h2>
    <ul>
      <li>Documentar los puertos filtrados y los que responden</li>
      <li>Registrar los TTL y respuestas ICMP observadas</li>
      <li>Comparar resultados entre t√©cnicas normales y evasivas</li>
    </ul>
  </section>

  <section>
    <h2>12. Contramedidas</h2>
    <ul>
      <li>Configurar el firewall para bloquear escaneos ACK y fragmentados</li>
      <li>Activar inspecci√≥n profunda de paquetes (DPI)</li>
      <li>Correlacionar eventos en el SIEM para detectar fingerprinting</li>
    </ul>
  </section>

  <section>
    <h2>13. Riesgos y advertencias</h2>
    <p>El uso de t√©cnicas de fingerprinting puede activar alertas o bloqueos en sistemas defensivos. Este laboratorio debe realizarse en entornos controlados. No ejecutar en redes reales sin autorizaci√≥n expresa.</p>
  </section>

  <section>
    <h2>14. Evidencias</h2>
    <p><em>Espacio reservado para capturas de pantalla de Nmap, hping3, firewalk, Wireshark y logs de firewall.</em></p>
  </section>

  <section>
    <h2>15. Validaci√≥n cruzada</h2>
    <ul>
      <li><a href="https://attack.mitre.org/techniques/T1595/002/" target="_blank">MITRE ATT&CK T1595.002 ‚Äì Active Scanning</a></li>
      <li><a href="https://www.cisecurity.org/controls/network-monitoring-and-defense" target="_blank">CIS Control 13 ‚Äì Network Monitoring and Defense</a></li>
      <li><a href="https://csrc.nist.gov/publications/detail/sp/800-41/rev-1/final" target="_blank">NIST SP 800-41 ‚Äì Guidelines on Firewalls and Firewall Policy</a></li>
    </ul>
  </section>

  <section>
    <h2>16. Glosario asociado</h2>
    <ul>
      <li><strong>Firewall:</strong> Sistema que filtra tr√°fico de red seg√∫n reglas definidas</li>
      <li><strong>Stateless:</strong> Firewall que filtra paquetes sin mantener estado de conexi√≥n</li>
      <li><strong>Stateful:</strong> Firewall que analiza el estado de la conexi√≥n antes de permitir tr√°fico</li>
      <li><strong>TTL:</strong> Valor que limita la vida √∫til de un paquete en la red</li>
      <li><strong>ACK Scan:</strong> T√©cnica para detectar puertos filtrados sin establecer conexi√≥n</li>
    </ul>
  </section>

  <section>
    <h2>17. Preguntas de refuerzo</h2>
    <ol>
      <li>¬øQu√© diferencia hay entre un firewall stateless y uno stateful?</li>
      <li>¬øQu√© indica una respuesta ICMP Type 3 durante un escaneo?</li>
      <li>¬øQu√© utilidad tiene manipular el TTL en un escaneo?</li>
      <li>¬øQu√© riesgos implica el fingerprinting en redes reales?</li>
      <li>¬øQu√© t√©cnicas permiten evadir reglas b√°sicas de firewall?</li>
    </ol>
  </section>

    <section>
    <h2>18. R√∫brica de evaluaci√≥n</h2>
    <ul>
      <li>‚úîÔ∏è Ejecuta correctamente t√©cnicas de fingerprinting y captura evidencias</li>
      <li>‚úîÔ∏è Interpreta el comportamiento del firewall ante cada t√©cnica</li>
      <li>‚úîÔ∏è Relaciona t√©cnicas con est√°ndares y certificaciones</li>
      <li>‚úîÔ∏è Aplica medidas y contramedidas con criterio t√©cnico</li>
    </ul>
  </section>

  <section>
    <h2>19. Recursos complementarios</h2>
    <ul>
      <li><a href="https://nmap.org/book/man-bypass-firewalls-ids.html" target="_blank">Nmap Firewall/IDS Evasion Techniques</a></li>
      <li><a href="https://linux.die.net/man/8/firewalk" target="_blank">firewalk man page</a></li>
      <li><a href="https://wiki.wireshark.org/" target="_blank">Wireshark Wiki</a></li>
      <li><a href="https://www.hping.org/" target="_blank">hping3 ‚Äì Packet Generator and Analyzer</a></li>
    </ul>
  </section>

  <section>
    <h2>20. Cr√©ditos y licencia</h2>
    <p>Este laboratorio forma parte del proyecto <a href="https://pergamino-digital-ciberseguridad.blogspot.com/?m=1" target="_blank">El Pergamino Digital</a>. Su uso est√° autorizado √∫nicamente con fines educativos, respetando la trazabilidad editorial y la licencia CC BY-NC-SA 4.0.</p>
  </section>

  <section>
    <h2>21. Nivel de certificaci√≥n</h2>
    <p>Intermedio ‚Äì Alineado con OSCP, Red Team Operator y eJPTv2.</p>
  </section>

  <section>
    <h2>22. Mapa de integraci√≥n</h2>
    <ul>
      <li>üîó Precede al <strong>Lab 22</strong> (Detecci√≥n de IPS y evasi√≥n b√°sica)</li>
      <li>üß™ Refuerza el dominio de t√©cnicas de reconocimiento activo y evasi√≥n inicial</li>
      <li>üéì Integra conceptos clave del simulador certificador: <em>Network Discovery</em>, <em>Firewall Fingerprinting</em>, <em>Defense Mapping</em></li>
    </ul>
  </section>

</body>
</html>
